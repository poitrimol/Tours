
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Reverse-Proxy/">
      
      
        <link rel="next" href="../heartbeat/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>-OpenVPN - Tours</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openvpn-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tours" class="md-header__button md-logo" aria-label="Tours" data-md-component="logo">
      
  <img src="../img/sio.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tours
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              -OpenVPN
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tours" class="md-nav__button md-logo" aria-label="Tours" data-md-component="logo">
      
  <img src="../img/sio.png" alt="logo">

    </a>
    Tours
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Tours
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../infra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nutanix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Nutanix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trs_dm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -DHCP & DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activation_SSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../routeur/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Routeurs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hsrp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -HSRP & GLPB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Firewall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inter_vlan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Inter VLAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../port_mirroring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Port mirroring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serveur_http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Serveur HTTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DNS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificat%20ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Certificat ssl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wordpress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Wordpress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Reverse-Proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Reverse Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    -OpenVPN
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    -OpenVPN
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Présentation :
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-du-serveur-openvpn" class="md-nav__link">
    <span class="md-ellipsis">
      Mise en place du serveur OpenVPN :
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../heartbeat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Heartbeat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load_balancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    -Load Balancing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Présentation :
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-du-serveur-openvpn" class="md-nav__link">
    <span class="md-ellipsis">
      Mise en place du serveur OpenVPN :
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="openvpn-server"><strong>OpenVPN Server</strong></h1>
<h2 id="presentation">Présentation :</h2>
<p>OpenVPN est une solution open-source de réseau privé virtuel (VPN) qui permet de créer des connexions sécurisées et cryptées entre des ordinateurs distants via Internet. Il offre une solution flexible, extensible et compatible avec de nombreuses plateformes pour établir des tunnels VPN, permettant ainsi le transfert sécurisé de données sur des réseaux non sécurisés.</p>
<h2 id="mise-en-place-du-serveur-openvpn">Mise en place du serveur OpenVPN :</h2>
<ul>
<li>
<p>Etape 1 : Création d'une VM Debian 12</p>
</li>
<li>
<p>Etape 2 : Installation de OpenVPN</p>
<p>sudo apt-get update
sudo apt install openvpn</p>
</li>
<li>
<p>Etape 3 : Installation de Easy-RSA</p>
</li>
</ul>
<p>Le package Easy-RSA fournit des utilitaires pour générer des paires de clés SSL utilisées pour sécuriser les connexions VPN.</p>
<pre><code>sudo apt install easy-rsa
</code></pre>
<ul>
<li>Etape 4 : Initialiser PKI OpenVPN</li>
</ul>
<p>une clé publique et une clé privée pour le serveur et chaque client
un certificat et une clé d'autorité de certification (CA) principale qui sont utilisés pour signer chacun des certificats du serveur et du client.</p>
<pre><code>cd /usr/share/easy-rsa/
./easyrsa init-pki
</code></pre>
<ul>
<li>
<p>Etape 5 : Génerer le Certificat et la clé de l'autorité de certification (CA)</p>
<p>cd /usr/share/easy-rsa/
./easyrsa build-ca</p>
</li>
</ul>
<p>Cela vous demandera la clé CA, la phrase de passe PEM ainsi que le nom commun du serveur.</p>
<p>Le certificat CA est généré et stocké dans  /usr/share/easy-rsa/pki/ca.crt</p>
<ul>
<li>
<p>Etape 6 : Générer des paramètres Diffie Hellman</p>
<p>cd /usr/share/easy-rsa/
./easyrsa gen-dh</p>
</li>
</ul>
<p>Paramètres DH de taille 2048 créés à /usr/share/easy-rsa/pki/dh.pem</p>
<ul>
<li>
<p>Etape 7 : Générer le certificat et la clé du serveur OpenVPN</p>
<p>cd /usr/share/easy-rsa/
./easyrsa build-server-full serveur nopass</p>
</li>
</ul>
<p>Saisissez la phrase secrète de l'autorité de certification créée ci-dessus pour générer les certificats et les clés.</p>
<ul>
<li>
<p>Etape 8 : Générer une clé de code d'authentification de message basée sur le hachage (HMAC)</p>
<p>sudo openvpn --genkey secret /usr/share/easy-rsa/pki/ta.key</p>
</li>
<li>
<p>Etape 9 : Générer un certificat de révocation OpenVPN</p>
<p>cd /usr/share/easy-rsa/
./easyrsa gen-crl</p>
</li>
</ul>
<p>Le certificat de révocation est généré et stocké dans  /usr/share/easy-rsa/pki/crl.pem</p>
<ul>
<li>
<p>Etape 10 : Copier les certificats et les clés du serveur dans le répertoire de configuration du serveur</p>
<p>cp -rp /usr/share/easy-rsa/pki/{ca.crt,dh.pem,ta.key,crl.pem,issued,private} /etc/openvpn/server/</p>
</li>
<li>
<p>Etape 11 : Générer des certificats et des clés client OpenVPN</p>
<p>cd /usr/share/easy-rsa/
./easyrsa build-client-full <nom d'utilisateur> nopass</p>
</li>
<li>
<p>Etape 12 : Copier les certificats clients et les clés dans le répertoire client</p>
<p>mkdir /etc/openvpn/client/<nom d'utilisateur>
cp -rp /usr/share/easy-rsa/pki/{ca.crt,issued/<nom d'utilisateur>.crt,private/<nom d'utilisateur>.key} /etc/openvpn/client/<nom d'utilisateur></p>
</li>
<li>
<p>Etape 13 : Configurer le serveur OpenVPN sur Debian 12</p>
</li>
</ul>
<p>Copiez l'exemple de configuration du serveur OpenVPN dans /etc/openvpn/server</p>
<pre><code>cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/
</code></pre>
<p>Commande pour voir les modifications effectuer : 
    grep -vE "^$|^#|^;" /etc/openvpn/server/server.conf</p>
<pre><code>port 1194
proto udp4
dev tun
ca ca.crt
cert issued/server.crt
key private/server.key  # This file should be kept secret
dh dh.pem 
topology subnet
server 172.16.20.0 255.255.255.0
ifconfig-pool-persist /var/log/openvpn/ipp.txt
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 9.9.9.9"
push "dhcp-option DNS 8.8.8.8"
client-to-client
keepalive 10 120
tls-auth ta.key 0 # This file is secret
cipher AES-256-CBC
persist-key
persist-tun
status /var/log/openvpn/openvpn-status.log
log-append  /var/log/openvpn/openvpn.log
verb 3
explicit-exit-notify 1
auth SHA512
</code></pre>
<ul>
<li>Etape 14 : Configurer le transfert IP</li>
</ul>
<p>Décommentez la ligne , net.ipv4.ip_forward=1pour /etc/sysctl.confactiver le transfert de paquets pour IPv4</p>
<pre><code>sed -i 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/' /etc/sysctl.conf
</code></pre>
<p>Appliquez les modifications sans redémarrer le serveur.</p>
<pre><code>sysctl -p
</code></pre>
<ul>
<li>
<p>Etape 15 : Autoriser le port du service OpenVPN via le pare-feu</p>
<p>ufw autorise 1194/udp</p>
</li>
<li>
<p>Etape 16 : Configurer le Masquerading sur le pare-feu</p>
</li>
</ul>
<p>Trouvez votre interface par défaut via laquelle vos paquets sont envoyés.</p>
<pre><code>ip route get 10.28.37.1
</code></pre>
<p>Ensuite on met a jour les règles du pare-feu</p>
<pre><code>vim /etc/ufw/before.rules
</code></pre>
<p>Ajoutez les lignes suivantes juste avant les *filterparamètres du tableau. Notez que l'interface utilisée doit correspondre au nom de l'interface ci-dessus</p>
<pre><code>*nat
:POSTROUTING ACCEPT [0:0]
-A POSTROUTING -s 10.28.37.0/24 -o enp0s3 -j MASQUERADE
COMMIT
# Don't delete these required lines, otherwise there will be errors
*filter
</code></pre>
<p>Activer le transfert de paquets UFW </p>
<pre><code>sed -i 's/DEFAULT_FORWARD_POLICY="DROP"/DEFAULT_FORWARD_POLICY="ACCEPT"/' /etc/default/ufw
</code></pre>
<p>Recharger le pare-feu</p>
<pre><code>ufw reload
</code></pre>
<ul>
<li>
<p>Etape 17 : Exécuter le serveur OpenVPN</p>
<p>systemctl enable --now openvpn-server@server</p>
</li>
</ul>
<p>Vérifier le status</p>
<pre><code>systemctl status openvpn-server@server
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>